<!DOCTYPE html>
<html lang="en">

    <head>
        {% load static %}
        <meta charset="utf-8">
        <link rel="icon" href="{% static 'img/sauver-la-nature.png' %}" type="image/x-icon">
        <title>TOLOKOTA - BLOG</title>
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta content="" name="keywords">
        <meta content="" name="description">

        <!-- Google Web Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Jost:wght@500;600&family=Roboto&display=swap" rel="stylesheet">

        <!-- Icon Font Stylesheet -->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"/>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

        <!-- Libraries Stylesheet -->
        <link href="{% static "lib/owlcarousel/assets/owl.carousel.min.css" %}" rel="stylesheet">
        <link href="{% static "lib/lightbox/css/lightbox.min.css" %}" rel="stylesheet">


        <!-- Customized Bootstrap Stylesheet -->
        <link href="{% static "css/bootstrap.min.css" %}" rel="stylesheet">

        <!-- Template Stylesheet -->
        <link href="{% static "css/style.css" %}" rel="stylesheet">
        <link href="{% static "css/custom.css" %}" rel="stylesheet">

        <script>

        </script>
    </head>

    <body>

        <!-- Spinner Start -->
        <div id="spinner" class="show w-100 vh-100 bg-white position-fixed translate-middle top-50 start-50  d-flex align-items-center justify-content-center">
            <div class="spinner-grow text-primary" role="status"></div>
        </div>
        <!-- Spinner End -->


        <!-- Navbar start -->
        <div class="container-fluid fixed-top px-0">
            <div class="container px-0">
                <div class="topbar">
                    <div class="row align-items-center justify-content-center">
                        <div class="col-md-8">
                            <div class="topbar-info d-flex flex-wrap">
                                <a href="#" class="text-light me-4"><i class="fas fa-envelope text-white me-2"></i>Example@gmail.com</a>
                                <a href="#" class="text-light"><i class="fas fa-phone-alt text-white me-2"></i>+01234567890</a>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="topbar-icon d-flex align-items-center justify-content-end">
                                <a href="#" class="btn-square text-white me-2"><i class="fab fa-facebook-f"></i></a>
                                <a href="#" class="btn-square text-white me-2"><i class="fab fa-twitter"></i></a>
                                <a href="#" class="btn-square text-white me-2"><i class="fab fa-instagram"></i></a>
                                <a href="#" class="btn-square text-white me-2"><i class="fab fa-pinterest"></i></a>
                                <a href="#" class="btn-square text-white me-0"><i class="fab fa-linkedin-in"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
                <nav class="navbar navbar-light bg-light navbar-expand-xl">
                    <a href="{% url "home" %}" class="navbar-brand ms-3">
                        <h1 class="text-primary display-5"><img src="{% static "img/TOLOKOTA.png" %}" width="200"></h1>
                    </a>
                    <button class="navbar-toggler py-2 px-3 me-3" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
                        <span class="fa fa-bars text-primary"></span>
                    </button>
                    <div class="collapse navbar-collapse bg-light" id="navbarCollapse">
                        <div class="navbar-nav ms-auto">
                            <a href="{% url "home" %}" class="nav-item nav-link">Accueil</a>
                            <a href="{% url "about" %}" class="nav-item nav-link">A propos</a>
                            <a href="#" class="nav-item nav-link active">Blog</a>
                            <a href="{% url "maps" %}" class="nav-item nav-link">Maps</a>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
        <!-- Navbar End -->

        <!-- Header Start -->
        <div class="container-fluid bg-breadcrumb" style="
            background-image: url('../../static/img/img7.avif');
            background-size: cover;
            background-position: bottom;
        ">
            <div class="container text-center py-5" style="height: 55vh;">

            </div>
        </div>
        <!-- Header End -->

        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-3 py-3 border-top">
                    <a class="text-center d-none mb-3 w-100 user-connected" style="border-radius: 15px">
                    </a>
                    <a class="btn btn-info text-white text-start mb-3 w-100" id="btn-connexion" style="border-radius: 15px" data-bs-toggle="modal" data-bs-target="#exampleModal">
                        <i class="fa fa-user mx-2"></i>
                        <span class="">Se connecter</span>
                    </a>
                    <a class="mb-3 btn btn-outline-light text-start w-100 text-dark border-0" style="border-radius: 15px">
                        <i class="fa fa-trash mx-2"></i>
                        <span>Voir les zones vertes</span>
                    </a>
                    <a class="mb-3 btn btn-outline-light text-start w-100 text-dark border-0" style="border-radius: 15px">
                        <i class="fa fa-newspaper mx-2"></i>
                        <span>Nouvelles</span>
                    </a>

                    <!-- Modal -->
                    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-body">
                                    <h3 class="text-center">Connexion</h3>
                                    <form class="px-5" method="post" id="login">
                                        <p id="error-mgs" class="text-danger text-center"></p>
                                        <label>Pseudo</label>
                                        <input class="form-control" name="pseudo" type="text">
                                        <br>
                                        <label>Mots de passe</label>
                                        <input class="form-control" name="password" type="password">

                                        <div class="modal-footer d-flex justify-content-center">
                                            <button type="button" class="btn btn-dark" data-dismiss="modal">Annuler</button>
                                            <button type="submit" class="btn btn-outline-success">Se connecter</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="col-lg-6 min-vh-100 border border-bottom-0 border-light">
                    <div class="row">
                        <form id="post" method="post" class="col-lg-12 py-3 mb-4" style="background: whitesmoke">
                            <div class="d-flex">
                                <input type="text" name="description" class="form-control border-0 bg-transparent" placeholder="Je signal un coin sale...">
                            </div>
                            <div class="d-flex align-items-center justify-content-between ps-3">
                                <div class="d-flex gap-4">
                                    <input type="file" accept="image/*" name="image" class="visually-hidden-focusable">
                                    <input type="hidden" name="longitude" class="visually-hidden-focusable">
                                    <input type="hidden" name="latitude" class="visually-hidden-focusable">
                                    <input type="hidden" name="user" class="visually-hidden-focusable">

                                    <a class="fa fa-camera"
                                       onclick="
                                            document.querySelector(`input[name='image']`).click()
                                        "></a>
                                    <a class="fa fa-plus"></a>
                                    <a class="fa fa-map-pin" onclick="getLocation()"></a>
                                    <small id="demo"></small>
                                </div>
                                <div>
                                    <button class="btn btn-secondary ms-auto" style="border-radius: 15px">
                                        <i class="fab fa-telegram-plane	"></i>
                                    </button>
                                </div>
                            </div>
                        </form>
                        <div class="col-lg-12" style="min-height: 400px;" id="section-feeds">
                            <div class="row px-3">
                                <div class="col-12">
                                    <p class="py-2 skeleton w-25"  ></p>
                                    <p class="skeleton py-2 w-100"></p>
                                </div>
                                <div class="col-12">
                                    <img class="skeleton border-0" src=" " alt="" style="width:100%; height:300px; outline: none; border-radius: 15px">
                                </div>
                                <div class="col-11">
                                    <p class="py-2 skeleton w-25 mb-3 mt-2"  ></p>
                                </div>
                            </div>
                            <hr class="mx-3 border-bottom">
                        </div>
                    </div>
                </div>


                <div class="col-lg-3 py-3 px-2 border-top">
                    <div class="mx-2 " style="border-radius: 15px">
                        <h6>Ariel Makal</h6>
                        <em class="blockquote">
                            "Lorem ipsum dolor sit amet, consectetur adipiscing elit,
                            sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
                            Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi
                            ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit
                            in voluptate velit esse cillum dolore eu fugiat nulla pariatur."
                        </em>
                    </div>
                </div>
            </div>


        </div>

        <!-- Footer Start -->
        <div class="container-fluid footer bg-dark text-body py-5">
            <div class="container py-5">
                <div class="row g-5">
                    <div class="col-md-6 col-lg-6 col-xl-3">
                        <div class="footer-item">
                            <h4 class="mb-4 text-white">Newsletter</h4>
                            <p class="mb-4">Dolor amet sit justo amet elitr clita ipsum elitr est.Lorem ipsum dolor sit amet, consectetur adipiscing elit consectetur adipiscing elit.</p>
                            <div class="position-relative mx-auto">
                                <input class="form-control border-0 bg-secondary w-100 py-3 ps-4 pe-5" type="text" placeholder="Enter your email" style="box-shadow: none">
                                <button type="button" class="btn-hover-bg btn btn-primary position-absolute top-0 end-0 py-2 mt-2 me-2">SignUp</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-6 col-xl-3">
                        <div class="footer-item d-flex flex-column">
                            <h4 class="mb-4 text-white">Our Services</h4>
                            <a href=""><i class="fas fa-angle-right me-2"></i> Ocean Turtle</a>
                            <a href=""><i class="fas fa-angle-right me-2"></i> White Tiger</a>
                            <a href=""><i class="fas fa-angle-right me-2"></i> Social Ecology</a>
                            <a href=""><i class="fas fa-angle-right me-2"></i> Loneliness</a>
                            <a href=""><i class="fas fa-angle-right me-2"></i> Beauty of Life</a>
                            <a href=""><i class="fas fa-angle-right me-2"></i> Present for You</a>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-6 col-xl-3">
                        <div class="footer-item d-flex flex-column">
                            <h4 class="mb-4 text-white">Volunteer</h4>
                            <a href=""><i class="fas fa-angle-right me-2"></i> Karen Dawson</a>
                            <a href=""><i class="fas fa-angle-right me-2"></i> Jack Simmons</a>
                            <a href=""><i class="fas fa-angle-right me-2"></i> Michael Linden</a>
                            <a href=""><i class="fas fa-angle-right me-2"></i> Simon Green</a>
                            <a href=""><i class="fas fa-angle-right me-2"></i> Natalie Channing</a>
                            <a href=""><i class="fas fa-angle-right me-2"></i> Caroline Gerwig</a>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-6 col-xl-3">
                        <div class="footer-item">
                            <h4 class="mb-4 text-white">Our Gallery</h4>
                            <div class="row g-2">
                                <div class="col-4">
                                    <div class="footer-gallery">
                                        <img src="{% static "img/gallery-footer-1.jpg" %}" class="img-fluid w-100" alt="">
                                        <div class="footer-search-icon">
                                            <a href="{% static "img/gallery-footer-1.jpg" %}" data-lightbox="footerGallery-1" class="my-auto"><i class="fas fa-search-plus text-white"></i></a>
                                        </div>
                                    </div>
                               </div>
                               <div class="col-4">
                                    <div class="footer-gallery">
                                        <img src="{% static "img/gallery-footer-2.jpg" %}" class="img-fluid w-100" alt="">
                                        <div class="footer-search-icon">
                                            <a href="{% static "img/gallery-footer-2.jpg" %}" data-lightbox="footerGallery-2" class="my-auto"><i class="fas fa-search-plus text-white"></i></a>
                                        </div>
                                    </div>
                               </div>
                                <div class="col-4">
                                    <div class="footer-gallery">
                                        <img src="{% static "img/gallery-footer-3.jpg" %}" class="img-fluid w-100" alt="">
                                        <div class="footer-search-icon">
                                            <a href="{% static "img/gallery-footer-3.jpg" %}" data-lightbox="footerGallery-3" class="my-auto"><i class="fas fa-search-plus text-white"></i></a>
                                        </div>
                                    </div>
                               </div>
                                <div class="col-4">
                                    <div class="footer-gallery">
                                        <img src="{% static "img/gallery-footer-4.jpg" %}" class="img-fluid w-100" alt="">
                                        <div class="footer-search-icon">
                                            <a href="{% static "img/gallery-footer-4.jpg" %}" data-lightbox="footerGallery-4" class="my-auto"><i class="fas fa-search-plus text-white"></i></a>
                                        </div>
                                    </div>
                               </div>
                                <div class="col-4">
                                    <div class="footer-gallery">
                                        <img src="{% static "img/gallery-footer-5.jpg" %}" class="img-fluid w-100" alt="">
                                        <div class="footer-search-icon">
                                            <a href="{% static "img/gallery-footer-5.jpg" %}" data-lightbox="footerGallery-5" class="my-auto"><i class="fas fa-search-plus text-white"></i></a>
                                        </div>
                                    </div>
                               </div>
                               <div class="col-4">
									<div class="footer-gallery">
										<img src="{% static "img/gallery-footer-6.jpg" %}" class="img-fluid w-100" alt="">
                                        <div class="footer-search-icon">
                                            <a href="{% static "img/gallery-footer-6.jpg" %}" data-lightbox="footerGallery-6" class="my-auto"><i class="fas fa-search-plus text-white"></i></a>
                                        </div>
									</div>
								</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Footer End -->








        <!-- Back to Top -->
        <a href="#" class="btn btn-primary btn-primary-outline-0 btn-md-square back-to-top"><i class="fa fa-arrow-up"></i></a>


        <!-- JavaScript Libraries -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="../lib/easing/easing.min.js"></script>
        <script src="{% static "lib/waypoints/waypoints.min.js" %}"></script>
        <script src="{% static "lib/counterup/counterup.min.js" %}"></script>
        <script src="{% static "lib/owlcarousel/owl.carousel.min.js" %}"></script>
        <script src="{% static "lib/lightbox/js/lightbox.min.js" %}"></script>
        <script src="{% static "node_modules/moment/min/moment.min.js" %}"></script>


        <!-- Template Javascript -->
        <script src="{% static "js/main.js" %}"></script>
        <script src="{% static "js/blog.js" %}"></script>
        <script>
            $('#post').on('submit',async function (event) {
                event.preventDefault(); // stop l'action du submit a ce niveau

                let longitude = $('input[name="longitude"]').val()
                let latitude = $('input[name="latitude"]').val()
                let file = document.querySelector('input[name="image"]').files[0]
                let description = $('input[name="description"]').val()

                if(window.sessionStorage.getItem('user') === null){
                    $('#exampleModal').modal('show');
                    return false;
                }

                var body = {
                    'owner': '/api/users/'+ window.sessionStorage.getItem('user'),
                    'latitude': latitude,
                    'longitude': longitude,
                    'description': description,
                    'image': await upload(file),
                    'createdAt': moment()
                }

                let headers = new Headers();

                headers.append('Content-Type', 'application/ld+json');
                headers.append('Accept', 'application/ld+json');

                fetch(BASE_URL+"/api/posts",{
                    method: "post",
                    headers:headers,
                    body: JSON.stringify(body)
                }).then((response)=>{
                    return response.json()
                }).then((result)=>{
                    window.location.reload();
                    console.log(result)
                })

            })

            async function upload(file){
                const response = await fetch(BASE_URL+"/file/upload",{
                    method: "POST",
                    body: JSON.stringify(
                        {'file': await getBase64(file)}
                    )
                })

                return response.json();
            }

            const toBase64 = file => new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
            });

            async function getBase64(file) {
                return toBase64(file)
            }
        </script>
        <script>
            $('#login').on('submit',function (event) {
                event.preventDefault();

                let pseudo = $('input[name="pseudo"]').val()
                let password = $('input[name="password"]').val()

                let body= {
                    'pseudo': pseudo,
                    'password': password
                }

                fetch(BASE_URL+"/login",{
                    method: "post",
                    body: JSON.stringify(body)
                })
                .then((response)=>{
                   return response.json()
                })
                .then((result)=>{
                    $('#error-mgs').html(result.message)
                    if(result.status) {
                        window.sessionStorage.setItem('user',result.user['id'])// met l'id de l' utilisateur ne session
                        window.sessionStorage.setItem('user_name',result.user['name'])// met l'id de l' utilisateur ne session
                        window.sessionStorage.setItem('user_pseudo',result.user['pseudo'])// met l'id de l' utilisateur ne session
                        window.location.reload();
                    }
                    console.log(result)
                })

                return false;
            })
        </script>

        <script>
            if(window.sessionStorage.getItem('user')){
                $('#btn-connexion').hide();
                $('.user-connected').html(window.sessionStorage.getItem('user_name'));
                $('.user-connected').show();
            }
        </script>
    </body>

</html>